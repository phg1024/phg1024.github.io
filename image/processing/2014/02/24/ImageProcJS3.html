<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>JavaScript Image Processing (3) - Brightness/Contrast Adjustment</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/style.css">

        <!-- MathJax -->
        <script type="text/javascript"
                src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
            });
        </script>

        <!-- jQuery -->
        <script type="text/javascript" src="/lib/jquery-1.10.2.min.js"></script>

        <!-- My own script -->
        <script type="text/javascript" src="/js/phgscript.js"></script>
    </head>
    <body>
        <div id="main">
	        <header>
	            <h1 class="title"><a href="/">Peihong's Infinite Dimensional Space</a></h1>
	        </header>
			
          <nav role="navigation">
			  <ul>
            <li><a href="/">home</a></li>
            <li><a href="/projects">projects</a></li>
            <li><a href="/blog.html">blog</a></li>
            <li><a href="/about.html">about</a></li>
            <li><a href="/contact.html">contact</a></li>
		      </ul>
          </nav>

          <div class="content">
    <p>
        
        <a class="prevpost" href="/image/processing/2014/01/05/ImageProcJS2.html">Previous Post</a>
        
        
        <a class="nextpost" href="/image/processing/2014/02/26/ImageProcJS4.html">Next Post</a>
        
    </p><br><br>
    <h2>JavaScript Image Processing (3) - Brightness/Contrast Adjustment</h2>
    <p class="meta">24 Feb 2014</p>
    <div class="post">
        <p>With the image class we created in previous posts, we are finally ready to have some fun with <em>image processing</em>.
As a first step, let&#39;s try something simple.</p>

<p>Something simple huh? What can be simpler than linear transformation? I guess that&#39;s what we are targeting here:
$$c_1 = \alpha \times c_0 + \beta$$
Simple as it is, we can still do something to make our images more appealing. Say we have somehow miscalculate the light
 and take a dark picture. A quick fix to it would be adjust the brightness of the image.</p>

<div align="center">
<table>
<tr>
<td><img class="post exampleimg" src="/projects/imageprocjs/seal.jpg"></td>
<td><img class="post exampleimg" src="/projects/imageprocjs/images/brightness55.png"></td>
</tr>
<tr>
<td>Source Image</td><td>Brightness Adjusted (+55) Image</td>
</tr>
</table>
</div>

<p>Since the brightness of a pixel is proportional to
its RGB values, it is obvious that we can change the brightness of a pixel by simply changing its RGB value.
The brightness filter adjust the overall brightness level of an input image by adding to or subtracting from
every pixel values directly. This corresponds to having $\alpha=1$ and $\beta\ne 0$ in linear transformation equation.
To maintain the color consistency, the amount of change must be the same for every channel
in every pixel.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">filters</span> <span class="o">=</span> <span class="p">{</span>
<span class="s1">&#39;brightness&#39;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">val</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="nx">src</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;RGBAImage&#39;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">dc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">src</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">c</span> <span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">nc</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">dc</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">nc</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Not a RGBA image!&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>


The contrast filter shares a similar idea, while the difference is, in terms of the linear transformation equation,
$\alpha\ne1$ and $\beta=0$. It is in fact a scaling of the pixel values. To set a boundary of the scaling, we take an input
of contrast amount $C$ ranging from -128 to 128 and compute $\beta$ with this value
$$\beta = \max\left(\frac{128+C}{128}, 0\right)$$

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">filters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;contrast&#39;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">val</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="nx">src</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;RGBAImage&#39;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">factor</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">((</span><span class="mi">128</span> <span class="o">+</span> <span class="nx">val</span><span class="p">)</span> <span class="o">/</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">src</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">c0</span> <span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">c0</span><span class="p">.</span><span class="nx">mulc</span><span class="p">(</span><span class="nx">factor</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Not a RGBA image!&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>


<div align="center">
<table>
<tr>
<td><img class="post exampleimg" src="/projects/imageprocjs/seal.jpg"></td>
<td><img class="post exampleimg" src="/projects/imageprocjs/images/contrast55.png"></td>
</tr>
<tr>
<td>Source Image</td><td>Contrast Adjusted (+55) Image</td>
</tr>
</table>
</div>

<p>Putting them together, we arrive at the brightness/contrast filter:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">filters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;brightnesscontrast&#39;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">alpha</span><span class="p">,</span> <span class="nx">beta</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span> <span class="nx">src</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;RGBAImage&#39;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">factor</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">((</span><span class="mi">128</span> <span class="o">+</span> <span class="nx">val</span><span class="p">)</span> <span class="o">/</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">dc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="nx">beta</span><span class="p">,</span> <span class="nx">beta</span><span class="p">,</span> <span class="nx">beta</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">src</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">c0</span> <span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">c0</span><span class="p">.</span><span class="nx">mulc</span><span class="p">(</span><span class="nx">factor</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">dc</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&quot;Not a RGBA image!&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>


<div align="center">
<table>
<tr>
<td><img class="post exampleimg" src="/projects/imageprocjs/seal.jpg"></td>
<td><img class="post exampleimg" src="/projects/imageprocjs/images/bc55.png"></td>
</tr>
<tr>
<td>Source Image</td><td>Brightness (+55) and Contrast (+55) Adjusted Image</td>
</tr>
</table>
</div>

    </div>
    <p>
        
        <a class="prevpost" href="/image/processing/2014/01/05/ImageProcJS2.html">Previous Post</a>
        
        
        <a class="nextpost" href="/image/processing/2014/02/26/ImageProcJS4.html">Next Post</a>
        
    </p><br><br>
    <div>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'pgh1024'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
    <div>
        <h3>Related Posts</h3>
        <div class="relatedposts">
            
            <li>
                <a href="/image/processing/2014/02/26/ImageProcJS4.html">
                    JavaScript Image Processing (4) - Histogram Equalization
                </a>
            </li>
            
            <li>
                <a href="/image/processing/2014/01/05/ImageProcJS2.html">
                    JavaScript Image Processing (2) - The Image Class
                </a>
            </li>
            
            <li>
                <a href="/image/processing/2014/01/04/ImageProcJS1.html">
                    JavaScript Image Processing (1) - Getting Started
                </a>
            </li>
            
            <li>
                <a href="/test/2013/12/04/Migrating.html">
                    Migrating to github.io
                </a>
            </li>
            
            <li>
                <a href="/test/2013/12/04/first.html">
                    First
                </a>
            </li>
            
        </div>
    </div>
</div>


          <footer>
          &copy 2009-2013 &nbsp Peihong Guo &nbsp 
   	    <script type="text/javascript">
   		    writeEmailAddress();
           </script>
           </footer>

       </div>
    </body>
</html>
